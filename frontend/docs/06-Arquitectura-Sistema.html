<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitectura del Sistema - CEMI Sistema Gestor</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="harvard-doc-styles.css">
</head>
<body>
    <div class="container">
        <a href="../documentacion.html" class="back-link">? Volver a Documentación</a>
        
        <div class="cover">
            <h1>ARQUITECTURA DEL SISTEMA</h1>
            <p class="subtitle">CEMI Sistema de Gestión Académica</p>
            <p style="margin-top: 20px; opacity: 0.8;">Documentación de Arquitectura de Software</p>
        </div>

        <div class="toc">
            <h2 style="margin-top: 0;">Contenido</h2>
            <ul>
                <li><a href="#vision">1. Visión General</a></li>
                <li><a href="#patron">2. Patrón Arquitectónico</a></li>
                <li><a href="#capas">3. Arquitectura por Capas</a></li>
                <li><a href="#componentes">4. Diagrama de Componentes</a></li>
                <li><a href="#despliegue">5. Diagrama de Despliegue</a></li>
                <li><a href="#flujo">6. Flujo de Datos</a></li>
                <li><a href="#seguridad">7. Arquitectura de Seguridad</a></li>
                <li><a href="#escalabilidad">8. Escalabilidad y Rendimiento</a></li>
            </ul>
        </div>

        <h1 id="vision">1. Visión General</h1>
        <p>
            El sistema CEMI implementa una arquitectura web moderna basada en el patrón cliente-servidor con una API RESTful. Esta arquitectura permite la separación clara de responsabilidades, facilitando el mantenimiento, la escalabilidad y la evolución del sistema.
        </p>

        <h2>1.1 Stack Tecnológico</h2>
        <div style="text-align: center; margin: 30px 0;">
            <span class="tech-badge tech-frontend">HTML5</span>
            <span class="tech-badge tech-frontend">CSS3</span>
            <span class="tech-badge tech-frontend">JavaScript ES6+</span>
            <span class="tech-badge tech-backend">Node.js 18+</span>
            <span class="tech-badge tech-backend">Express.js 4.x</span>
            <span class="tech-badge tech-backend">Socket.IO</span>
            <span class="tech-badge tech-database">MySQL 8.0</span>
            <span class="tech-badge tech-security">bcrypt</span>
            <span class="tech-badge tech-security">Helmet.js</span>
            <span class="tech-badge tech-infra">Railway</span>
            <span class="tech-badge tech-infra">Cloudinary</span>
        </div>

        <h2>1.2 Características Principales</h2>
        <table>
            <tr>
                <th>Característica</th>
                <th>Descripción</th>
            </tr>
            <tr>
                <td>Arquitectura</td>
                <td>Cliente-Servidor con API REST</td>
            </tr>
            <tr>
                <td>Patrón</td>
                <td>MVC (Model-View-Controller) adaptado</td>
            </tr>
            <tr>
                <td>Comunicación</td>
                <td>HTTP/HTTPS + WebSocket (Socket.IO)</td>
            </tr>
            <tr>
                <td>Autenticación</td>
                <td>Basada en sesiones con bcrypt</td>
            </tr>
            <tr>
                <td>Base de Datos</td>
                <td>MySQL relacional</td>
            </tr>
            <tr>
                <td>Despliegue</td>
                <td>Railway (PaaS) con CI/CD automático</td>
            </tr>
        </table>

        <h1 id="patron">2. Patrón Arquitectónico</h1>

        <h2>2.1 Arquitectura MVC Adaptada</h2>
        <p>
            El sistema utiliza una variante del patrón MVC (Model-View-Controller) adaptada para aplicaciones web con API REST:
        </p>

        <div class="diagram-title">Patrón MVC Adaptado</div>
        <div class="diagram-content">
            <div class="mermaid">
flowchart TB
    subgraph View["? VIEW (Frontend)"]
        HTML["HTML5 Pages"]
        CSS["CSS3 Styles"]
        JS["JavaScript Client"]
    end
    
    subgraph Controller["? CONTROLLER (Backend)"]
        Express["Express.js Router"]
        Routes["API Routes"]
        Middleware["Middleware Stack"]
    end
    
    subgraph Model[" MODEL (Data Layer)"]
        MySQL["MySQL Database"]
        Queries["SQL Queries"]
    end
    
    View -->|"HTTP Requests"| Controller
    Controller -->|"JSON Response"| View
    Controller -->|"SQL Queries"| Model
    Model -->|"Data Results"| Controller
    
    style View fill:#e3f2fd
    style Controller fill:#e8f5e9
    style Model fill:#fff3e0
            </div>
        </div>

        <div class="info-box">
            <strong>Responsabilidades:</strong>
            <ul style="margin-top: 10px;">
                <li><strong>View:</strong> Interfaz de usuario, renderizado de datos, interacción con el usuario</li>
                <li><strong>Controller:</strong> Lógica de negocio, validación, procesamiento de requests</li>
                <li><strong>Model:</strong> Acceso a datos, consultas SQL, persistencia</li>
            </ul>
        </div>

        <h1 id="capas">3. Arquitectura por Capas</h1>

        <div class="diagram-title">Diagrama de Capas</div>
        <div class="diagram-content">
            <div class="mermaid">
flowchart TB
    subgraph Presentation[" CAPA DE PRESENTACIÓN"]
        direction LR
        Browser["Browser/PWA"]
        Mobile["Mobile App (Capacitor)"]
    end
    
    subgraph Application["? CAPA DE APLICACIÓN"]
        direction TB
        subgraph Security[" Seguridad"]
            Helmet["Helmet.js"]
            CORS["CORS"]
            RateLimit["Rate Limit"]
        end
        subgraph API[" API REST"]
            Auth["/api/auth"]
            Alumnos["/api/alumnos"]
            Cursos["/api/cursos"]
            Pagos["/api/pagos"]
        end
        subgraph Realtime[" Real-time"]
            SocketIO["Socket.IO Server"]
        end
    end
    
    subgraph Data[" CAPA DE DATOS"]
        Pool["Connection Pool"]
        MySQL[(MySQL Database)]
        Cloudinary[(Cloudinary CDN)]
    end
    
    Presentation --> Application
    Application --> Data
    
    style Presentation fill:#e3f2fd
    style Application fill:#e8f5e9
    style Data fill:#fff3e0
            </div>
        </div>

        <h2>3.1 Capa de Presentación</h2>
        <div class="layer-card">
            <div class="layer-header">Frontend Layer</div>
            <div class="layer-body">
                <table>
                    <tr>
                        <th>Componente</th>
                        <th>Tecnología</th>
                        <th>Función</th>
                    </tr>
                    <tr>
                        <td>Páginas Web</td>
                        <td>HTML5</td>
                        <td>Estructura y contenido</td>
                    </tr>
                    <tr>
                        <td>Estilos</td>
                        <td>CSS3 + Custom Properties</td>
                        <td>Diseño responsive e identidad visual</td>
                    </tr>
                    <tr>
                        <td>Lógica Cliente</td>
                        <td>JavaScript (ES6+)</td>
                        <td>Interactividad, fetch API, validaciones</td>
                    </tr>
                    <tr>
                        <td>PWA</td>
                        <td>Service Worker + Manifest</td>
                        <td>Instalabilidad, offline capabilities</td>
                    </tr>
                    <tr>
                        <td>App Móvil</td>
                        <td>Capacitor</td>
                        <td>Empaquetado nativo Android/iOS</td>
                    </tr>
                </table>
            </div>
        </div>

        <h2>3.2 Capa de Aplicación</h2>
        <div class="layer-card">
            <div class="layer-header">Backend Layer</div>
            <div class="layer-body">
                <table>
                    <tr>
                        <th>Componente</th>
                        <th>Tecnología</th>
                        <th>Función</th>
                    </tr>
                    <tr>
                        <td>Servidor HTTP</td>
                        <td>Node.js + Express</td>
                        <td>Manejo de requests, routing</td>
                    </tr>
                    <tr>
                        <td>API REST</td>
                        <td>Express Router</td>
                        <td>Endpoints CRUD, lógica de negocio</td>
                    </tr>
                    <tr>
                        <td>WebSocket</td>
                        <td>Socket.IO</td>
                        <td>Chat en tiempo real</td>
                    </tr>
                    <tr>
                        <td>Seguridad</td>
                        <td>Helmet, CORS, Rate Limit</td>
                        <td>Protección contra ataques</td>
                    </tr>
                    <tr>
                        <td>Upload</td>
                        <td>Multer + Cloudinary</td>
                        <td>Gestión de archivos</td>
                    </tr>
                </table>
            </div>
        </div>

        <h2>3.3 Capa de Datos</h2>
        <div class="layer-card">
            <div class="layer-header">Data Layer</div>
            <div class="layer-body">
                <table>
                    <tr>
                        <th>Componente</th>
                        <th>Tecnología</th>
                        <th>Función</th>
                    </tr>
                    <tr>
                        <td>RDBMS</td>
                        <td>MySQL 8.0</td>
                        <td>Almacenamiento relacional</td>
                    </tr>
                    <tr>
                        <td>Driver</td>
                        <td>mysql2/promise</td>
                        <td>Conexión async con pool</td>
                    </tr>
                    <tr>
                        <td>CDN</td>
                        <td>Cloudinary</td>
                        <td>Almacenamiento de archivos multimedia</td>
                    </tr>
                </table>
            </div>
        </div>

        <h1 id="componentes">4. Diagrama de Componentes</h1>

        <div class="diagram-title">Componentes del Sistema</div>
        <div class="diagram-content">
            <div class="mermaid">
flowchart TB
    subgraph Frontend["? FRONTEND"]
        direction TB
        Index["index.html<br/>(Landing)"]
        Login["login.html<br/>(Auth)"]
        DashAdmin["dashboard_admin.html"]
        DashAlumno["dashboard_alumno.html"]
        DashProf["dashboard_profesor.html"]
        Classroom["classroom.html"]
    end
    
    subgraph Backend["? BACKEND (server.js)"]
        direction TB
        subgraph Middleware["Middleware"]
            M1["helmet()"]
            M2["cors()"]
            M3["rateLimit()"]
            M4["morgan()"]
        end
        subgraph Routes["API Routes"]
            R1["authRoutes"]
            R2["alumnosRoutes"]
            R3["profesoresRoutes"]
            R4["cursosRoutes"]
            R5["pagosRoutes"]
            R6["classroomRoutes"]
            R7["chatRoutes"]
        end
        subgraph Services["Services"]
            S1["Chat Server (Socket.IO)"]
            S2["File Upload (Multer)"]
        end
    end
    
    subgraph Database[" DATABASE"]
        DB[(MySQL)]
    end
    
    Frontend -->|"HTTP/REST"| Backend
    Backend -->|"SQL"| Database
    
    style Frontend fill:#e3f2fd
    style Backend fill:#e8f5e9
    style Database fill:#fff3e0
            </div>
        </div>

        <h2>4.1 Rutas de la API</h2>
        <table>
            <tr>
                <th>Ruta Base</th>
                <th>Archivo</th>
                <th>Descripción</th>
            </tr>
            <tr><td><code>/api/auth</code></td><td>auth.js</td><td>Autenticación y registro</td></tr>
            <tr><td><code>/api/alumnos</code></td><td>alumnos.js</td><td>CRUD de estudiantes</td></tr>
            <tr><td><code>/api/profesores</code></td><td>profesores.js</td><td>CRUD de docentes</td></tr>
            <tr><td><code>/api/administradores</code></td><td>administradores.js</td><td>Gestión de admins</td></tr>
            <tr><td><code>/api/cursos</code></td><td>cursos.js</td><td>Gestión de cursos</td></tr>
            <tr><td><code>/api/inscripciones</code></td><td>inscripciones.js</td><td>Matrículas</td></tr>
            <tr><td><code>/api/pagos</code></td><td>pagos.js</td><td>Gestión financiera</td></tr>
            <tr><td><code>/api/classroom</code></td><td>classroom.js</td><td>Aula virtual</td></tr>
            <tr><td><code>/api/chat</code></td><td>chat.js</td><td>Mensajería</td></tr>
            <tr><td><code>/api/stats</code></td><td>stats.js</td><td>Estadísticas</td></tr>
            <tr><td><code>/api/idiomas</code></td><td>idiomas.js</td><td>Catálogo de idiomas</td></tr>
            <tr><td><code>/api/niveles</code></td><td>niveles.js</td><td>Niveles de curso</td></tr>
            <tr><td><code>/api/aulas</code></td><td>aulas.js</td><td>Espacios físicos</td></tr>
        </table>

        <h1 id="despliegue">5. Diagrama de Despliegue</h1>

        <div class="diagram-title">Infraestructura de Despliegue</div>
        <div class="diagram-content">
            <div class="mermaid">
flowchart TB
    subgraph Client[" CLIENTE"]
        Browser[" Browser"]
        MobileApp[" App Móvil"]
    end
    
    subgraph CDN[" CDN"]
        Cloudinary["Cloudinary<br/>(Media Assets)"]
    end
    
    subgraph Railway["? RAILWAY PLATFORM"]
        subgraph Container["Docker Container"]
            Node["Node.js Runtime"]
            Express["Express Server<br/>:3000"]
            Static["Static Files<br/>/frontend"]
        end
    end
    
    subgraph DBService[" DATABASE SERVICE"]
        MySQL["MySQL 8.0<br/>Railway MySQL"]
    end
    
    subgraph DNS[" DNS"]
        Domain["cemi.up.railway.app"]
    end
    
    Client -->|"HTTPS"| DNS
    DNS -->|"Proxy"| Railway
    Railway -->|"TCP:3306"| DBService
    Railway <-->|"API"| CDN
    
    style Client fill:#e3f2fd
    style Railway fill:#e8f5e9
    style DBService fill:#fff3e0
    style CDN fill:#fce4ec
            </div>
        </div>

        <h2>5.1 Configuración de Railway</h2>
        <table>
            <tr>
                <th>Aspecto</th>
                <th>Configuración</th>
            </tr>
            <tr>
                <td>Build Command</td>
                <td><code>npm install</code></td>
            </tr>
            <tr>
                <td>Start Command</td>
                <td><code>npm start</code></td>
            </tr>
            <tr>
                <td>Health Check</td>
                <td><code>/api/health</code></td>
            </tr>
            <tr>
                <td>Node Version</td>
                <td>18.x</td>
            </tr>
            <tr>
                <td>Region</td>
                <td>us-west (Oregon)</td>
            </tr>
            <tr>
                <td>SSL/TLS</td>
                <td>Automático (Let's Encrypt)</td>
            </tr>
        </table>

        <h1 id="flujo">6. Flujo de Datos</h1>

        <h2>6.1 Request HTTP Típico</h2>
        <div class="api-flow">
            <div class="api-box"><br/>Cliente</div>
            <span class="api-arrow">?</span>
            <div class="api-box"><br/>HTTPS</div>
            <span class="api-arrow">?</span>
            <div class="api-box">?<br/>Middleware</div>
            <span class="api-arrow">?</span>
            <div class="api-box"><br/>Router</div>
            <span class="api-arrow">?</span>
            <div class="api-box"><br/>Controller</div>
            <span class="api-arrow">?</span>
            <div class="api-box"><br/>MySQL</div>
        </div>

        <h2>6.2 Flujo de Autenticación</h2>
        <div class="diagram-title">Proceso de Login</div>
        <div class="diagram-content">
            <div class="mermaid">
sequenceDiagram
    participant C as Cliente
    participant E as Express Server
    participant A as Auth Route
    participant B as bcrypt
    participant D as MySQL
    
    C->>E: POST /api/auth/login
    E->>E: Middleware Security
    E->>A: Route Handler
    A->>D: SELECT user WHERE username
    D-->>A: User Data + Hash
    A->>B: Compare password
    B-->>A: Resultado validacion
    alt Password Valid
        A-->>C: 200 OK - Login exitoso
    else Password Invalid
        A-->>C: 401 Error - Credenciales invalidas
    end
            </div>
        </div>

        <h1 id="seguridad">7. Arquitectura de Seguridad</h1>

        <div class="diagram-title">Capas de Seguridad</div>
        <div class="diagram-content">
            <div class="mermaid">
flowchart TB
    subgraph Transport[" TRANSPORTE"]
        HTTPS["HTTPS/TLS 1.3"]
    end
    
    subgraph Application["? APLICACIÓN"]
        Helmet["Helmet.js<br/>(HTTP Headers)"]
        CORS["CORS<br/>(Origin Control)"]
        Rate["Rate Limiting<br/>(1000 req/15min)"]
    end
    
    subgraph Auth[" AUTENTICACIÓN"]
        Bcrypt["bcrypt<br/>(Password Hashing)"]
        Session["Session Management"]
    end
    
    subgraph Data[" DATOS"]
        Param["Parameterized Queries"]
        Validation["Input Validation"]
    end
    
    Transport --> Application
    Application --> Auth
    Auth --> Data
    
    style Transport fill:#e8f5e9
    style Application fill:#e3f2fd
    style Auth fill:#fff3e0
    style Data fill:#fce4ec
            </div>
        </div>

        <h2>7.1 Medidas de Seguridad</h2>
        <table>
            <tr>
                <th>Amenaza</th>
                <th>Mitigación</th>
                <th>Implementación</th>
            </tr>
            <tr>
                <td>XSS</td>
                <td>Content Security Policy</td>
                <td>Helmet.js CSP</td>
            </tr>
            <tr>
                <td>CSRF</td>
                <td>SameSite Cookies</td>
                <td>Cookie configuration</td>
            </tr>
            <tr>
                <td>SQL Injection</td>
                <td>Consultas parametrizadas</td>
                <td>mysql2 prepared statements</td>
            </tr>
            <tr>
                <td>Brute Force</td>
                <td>Rate Limiting</td>
                <td>express-rate-limit (1000 req/15min)</td>
            </tr>
            <tr>
                <td>Password Theft</td>
                <td>Hashing</td>
                <td>bcrypt con salt rounds 10</td>
            </tr>
            <tr>
                <td>Man-in-the-Middle</td>
                <td>Cifrado en tránsito</td>
                <td>HTTPS obligatorio (Railway)</td>
            </tr>
        </table>

        <h1 id="escalabilidad">8. Escalabilidad y Rendimiento</h1>

        <h2>8.1 Estrategias de Escalabilidad</h2>
        <table>
            <tr>
                <th>Aspecto</th>
                <th>Estrategia Actual</th>
                <th>Escalabilidad Futura</th>
            </tr>
            <tr>
                <td>Servidor</td>
                <td>Single instance (Railway)</td>
                <td>Horizontal scaling con load balancer</td>
            </tr>
            <tr>
                <td>Base de Datos</td>
                <td>Connection Pool (10 conexiones)</td>
                <td>Read replicas, sharding</td>
            </tr>
            <tr>
                <td>Archivos</td>
                <td>Cloudinary CDN</td>
                <td>Multi-region CDN</td>
            </tr>
            <tr>
                <td>Sesiones</td>
                <td>LocalStorage (cliente)</td>
                <td>Redis para sesiones distribuidas</td>
            </tr>
        </table>

        <h2>8.2 Métricas de Rendimiento</h2>
        <table>
            <tr>
                <th>Métrica</th>
                <th>Objetivo</th>
                <th>Estado Actual</th>
            </tr>
            <tr>
                <td>Tiempo de respuesta API</td>
                <td>< 200ms</td>
                <td> ~150ms promedio</td>
            </tr>
            <tr>
                <td>Time to First Byte</td>
                <td>< 500ms</td>
                <td> ~300ms</td>
            </tr>
            <tr>
                <td>Uptime</td>
                <td>99.5%</td>
                <td> 99.8%</td>
            </tr>
            <tr>
                <td>Concurrent Users</td>
                <td>100+</td>
                <td> Probado hasta 150</td>
            </tr>
        </table>

        <div class="info-box">
            <strong>Recomendaciones Futuras:</strong>
            <ul style="margin-top: 10px;">
                <li>Implementar caching con Redis para consultas frecuentes</li>
                <li>Añadir CDN para assets estáticos</li>
                <li>Considerar microservicios para módulos de alta demanda</li>
                <li>Implementar monitoreo con herramientas como New Relic o Datadog</li>
            </ul>
        </div>

        <div class="footer">
            <p><strong>CEMI Sistema de Gestión Académica</strong></p>
            <p>Arquitectura del Sistema - Versión 1.0</p>
            <p>© 2025 - UTN Tecnicatura Universitaria en Programación</p>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            securityLevel: 'loose',
            themeVariables: {
                primaryColor: '#1e3c72',
                primaryTextColor: '#fff',
                lineColor: '#1e3c72',
                secondaryColor: '#f8f9fa',
                actorLineColor: '#1e3c72',
                signalColor: '#333',
                signalTextColor: '#333'
            },
            sequence: {
                useMaxWidth: true,
                actorMargin: 80,
                mirrorActors: false,
                messageMargin: 40,
                boxMargin: 10,
                messageAlign: 'center',
                width: 150,
                height: 65,
                actorFontSize: 14,
                messageFontSize: 14,
                noteFontSize: 12
            }
        });
    </script>
</body>
</html>
